using Test
@testset "simple models" begin
    using LogisticRegression
    y  = [0,1,0,1,1,0,1,0,1,1,1,0,0,0,0,0,1,1,0,0,0,1,1,0,1,1,1,0,0,0,1,1,1,1,0,0,1,0,1,0,0,0,0,0,1,1,0,1,1,0,0,0,0,0,1,1,0,0,1,0,0,0,0,1,0,0,1,0,1,0,1,1,1,0,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,0,1,0]
    x0 = ones(length(y))
    x1 = [2.5,1.7,4,2.3,3.7,4.8,1.9,5.3,3.1,1.9,2.3,3.6,4.7,5.8,6,3.9,2.4,1.7,3.7,4.8,3.2,2.7,1.2,8.2,1.8,2.5,2.2,4,4.2,3.7,2.4,1.6,2,2.5,3.8,4.3,2,5.2,2.4,2.6,1.3,3.8,4.5,3,2.1,1.9,1.7,1.7,1.3,2.5,3.5,5.6,3.8,4,2.5,1.2,3,3,2.1,2.5,2.9,4,3.2,1.2,3.5,4,2.3,2.9,2.4,5,2.2,1.3,1.7,3,3,3.5,5.8,4.8,2.3,2.6,1.8,2.9,3.2,4.2,2.6,6,4.5,1.3,2.4,4.3,1.8,2.4]
    x2 = [3,3,2,2,4,1,3,2,4,3,4,1,2,2,4,3,4,4,2,1,2,3,3,5,1,1,3,1,1,1,2,3,1,3,1,2,2,2,3,4,2,1,0,0,2,2,4,2,3,1,2,3,2,0,1,2,1,1,2,1,1,3,3,2,3,1,3,4,2,3,3,3,3,2,2,2,2,1,3,2,2,2,1,1,1,1,3,2,2,2,0,2]
    x3 = [0,0,0,0,1,1,1,0,0,0,0,1,0,1,1,0,0,0,1,1,0,0,0,1,0,0,0,1,1,1,0,0,0,0,1,1,0,1,1,1,0,0,0,0,0,0,1,0,0,0,1,1,1,1,0,1,1,1,0,1,1,1,1,0,1,1,0,1,0,1,1,0,0,1,0,0,0,1,0,0,0,0,1,1,1,1,0,0,0,1,0,1]
    X_0 = x0
    X_1 = hcat(x0, x1)
    X_2 = hcat(X_1, x2)
    X_3 = hcat(X_1, x3)

    @testset "model X_0" begin
        model_0 = logreg(y, X_0)
    end

    @testset "model X_1" begin
        model_1 = logreg(y[1:6], [x0[1:6] x1[1:6]]) 
        @test model_1.num_obs == 6
        @test model_1.beta_hat ≈ [3.971,-1.260 ]  atol = 1e-3
        @test model_1.dof_log == 2
        @test model_1.dof_resid == 4
        @test model_1.dof_total == 5
        @test model_1.pi_hat ≈ [0.6940996, 0.8614932, 0.2551409, 0.7448733, 0.3333144, 0.1110785] atol = 1e-3
        @test model_1.y_hat ≈ [1, 1 , 0, 1, 0, 0] atol = 1e-3
        @test model_1.llk ≈ -3.1391 atol = 1e-3 
        @test model_1.aic ≈  10.2782 atol = 1e-3 
        @test model_1.bic ≈ 9.86172 atol = 1e-3 
        @test model_1.dev_residuals ≈  [-1.5391528,  0.5460551, -0.7675418,  0.7675169,  1.4823421, -0.4852760] atol = 1e-3
    end

    @testset "model X_2" begin

    end

    @testset "model X_3" begin
    model_3 = logreg(y[1:6], [x0[1:6] x1[1:6] x2[1:6] x3[1:6]]) 
    @test model_3.num_obs == 6
    @test model_3.beta_hat ≈ [325.17, -110.06, -24.42, 203.64]  atol = 1e-3
    @test model_3.dof_log == 4
    @test model_3.dof_resid == 2
    @test model_3.dof_total == 5
    @test model_3.pi_hat ≈ [8.114495e-11, 1.000000e+00, 2.220446e-16, 1.000000e+00, 1.000000e+00, 4.127692e-11] atol = 1e-3
    @test model_3.y_hat ≈ [0, 1 , 0, 1, 1, 0] atol = 1e-3
    @test model_3.llk ≈ -2.482672e-10 atol = 1e-3 
    @test model_3.aic ≈  8 atol = 1e-3 
    @test model_3.bic ≈ 7.167038 atol = 1e-3 
    @test model_3.dev_residuals ≈  [-1.273932e-05,  2.107342e-08, -2.107342e-08,  1.300524e-05,  9.085921e-06, -9.085921e-06] atol = 1e-3

    end
end